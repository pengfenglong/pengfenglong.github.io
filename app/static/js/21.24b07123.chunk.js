webpackJsonp([21],{492:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(636),i=(n.n(a),n(637)),s=n.n(i),r=n(505),l=(n.n(r),n(504)),o=n.n(l),c=n(29),u=n.n(c),d=n(6),p=n.n(d),f=n(113),h=n.n(f),m=n(108),y=n.n(m),v=n(111),g=n.n(v),w=n(109),E=n.n(w),b=n(110),_=n.n(b),k=n(5),L=n.n(k),S=n(187),x=(n.n(S),n(503)),q=n(513),z=n(190),C=n(43),I=(x.c.CheckboxItem,function(e){function t(){var e,n,a,i;y()(this,t);for(var s=arguments.length,r=Array(s),l=0;l<s;l++)r[l]=arguments[l];return n=a=E()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(r))),a.state={fileList:[],styles:[],processs:[],total:0,selected:"\u8ba1\u4ef6"},i=n,E()(a,i)}return _()(t,e),g()(t,[{key:"componentDidMount",value:function(){var e=this;Object(C.e)({url:"rest/erp/processUser/queryByUser?departmentId="+(window.loginUser?window.loginUser.department.join(","):0),type:"get",success:function(t){var n=t.data.checkeds.map(function(e){return e.process_id}),a=function(e){for(var t=0;t<i.length;t++)if(i[t].id===e)return i[t];return null},i=[];t.data.all.forEach(function(e){-1!==n.indexOf(e.process_id)&&(a(e.style_id)?a(e.style_id).processs.push({id:e.process_id,name:e.process_name,price:e.process_price}):i.push({id:e.style_id,name:e.style_name,processs:[{id:e.process_id,name:e.process_name,price:e.process_price}]}))}),e.setState({styles:i}),0===i.length&&(window.location.hash="/erp/user/set-process")}}),window.dd.biz.navigation.setLeft({control:!0,text:"\u8fd4\u56de",onSuccess:function(e){},onFail:function(e){}}),window.dd.biz.navigation.setTitle({title:"\u5de5\u4f5c\u8ba1\u4ef6",onSuccess:function(e){},onFail:function(e){}}),window.dd.biz.navigation.setRight({show:!0,control:!0,text:"\u63d0\u4ea4\u5ba1\u6838",onSuccess:function(t){e.handleSubmit()},onFail:function(e){}})}},{key:"handleBack",value:function(){window.history.back()}},{key:"handleSubmit",value:function(e){var t=this,n=this.props.form;n.validateFields(function(e,a){e||(t.props.editId?t.props.dispatch(z.update(t.props.editId,a)):(t.state.fileList&&t.state.fileList.length>0&&(a.files=t.state.fileList.map(function(e){return{name:e.name,path:e.url,type:e.type,size:e.size}})),t.state.processs.forEach(function(e){e.quantity&&(a[e.id]=e.quantity)}),Object(C.e)({url:"rest/erp/userWork/save",type:"post",data:p()(a),success:function(e){x.t.success("\u4fdd\u5b58\u6210\u529f!",1),setTimeout(function(){window.location.hash="/erp/my-work"},1e3)}}),n.resetFields()))})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldProps;return L.a.createElement("div",null,L.a.createElement(x.h,null,L.a.createElement(x.d,u()({mode:"date",value:new Date(Date.now()),onChange:function(e){}},t("work_date",{initialValue:new Date(Date.now()),rules:[{required:!0}]})),L.a.createElement(x.h.Item,{arrow:"horizontal"},"\u8ba1\u4ef6\u65e5\u671f"))),L.a.createElement("div",{style:{margin:"0 5px"}},L.a.createElement(x.p,{values:["\u8ba1\u4ef6","\u56fe\u7247\u4e0a\u4f20"],onValueChange:function(t){e.setState({selected:t})}})),L.a.createElement("div",{style:{display:"\u8ba1\u4ef6"===this.state.selected?"block":"none"}},L.a.createElement(x.h,null,L.a.createElement(x.h.Item,{extra:L.a.createElement("b",{style:{marginRight:10,color:"red"}},"\xa5",this.state.total)},"\u603b\u8ba1\u5de5\u8d44")),this.state.styles.map(function(t){return L.a.createElement(x.h,{renderHeader:function(){return"\u6b3e\u5f0f:"+t.name}},t.processs.map(function(t){return L.a.createElement("div",{style:{marginLeft:20}},L.a.createElement(x.g,{placeholder:"\u8bf7\u8f93\u5165",type:"digit",labelNumber:10,extra:"\xa5"+t.price+"/\u4ef6",value:e.state[t.id]?e.state[t.id]:"",onChange:function(n){var a=e.state.processs,i=null;a.forEach(function(e){e.id===t.id&&(i=e)}),null==i?a.push({id:t.id,price:t.price,quantity:n}):i.quantity=n;var s=0;a.forEach(function(e){s+=e.price*e.quantity});var r={};r[t.id]=n,e.setState(r),e.setState({processs:a,total:s})}},L.a.createElement("div",{style:{width:150}},t.name)))}))})),L.a.createElement(x.u,null),L.a.createElement("div",{style:{display:"\u8ba1\u4ef6"===this.state.selected?"none":"block"}},L.a.createElement("div",{style:{padding:10}},L.a.createElement(s.a,{action:"rest/file/upload",name:"file",headers:{Authorization:"Bearer "+window.sessionStorage.getItem("edesk-token")},listType:"picture-card",fileList:this.state.fileList,multiple:!0,showUploadList:!0,onPreview:function(){},beforeUpload:function(t,n){return!(n.length+e.state.fileList.length>5)||(x.t.fail("\u56fe\u7247\u6570\u91cf\u4e0d\u80fd\u8d85\u8fc75\u5f20!",1),!1)},onChange:function(t){var n=t.fileList;n=n.filter(function(e){return!e.length}),n=n.map(function(e){if(e.response&&(e.url=e.response.data.savePath),!e.length)return e}),n&&0!=n.length&&e.setState({fileList:n}),e.forceUpdate()}},this.state.fileList.length>=5?null:L.a.createElement("div",null,L.a.createElement(o.a,{type:"plus"}),L.a.createElement("div",{className:"ant-upload-text"},"\u70b9\u51fb\u4e0a\u4f20"))))),L.a.createElement(x.u,null),"mobile"!==C.g.get("view")?L.a.createElement("div",{style:{margin:"0 10px",clear:"both"}},L.a.createElement(x.a,{type:"primary",onClick:this.handleSubmit.bind(this)},"\u63d0\u4ea4\u5ba1\u6838")):null)}}]),t}(L.a.Component));I=Object(S.connect)()(Object(q.a)()(I)),t.default=I}});